<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‚šì‹œ ê²Œì„</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #eaf6fb; margin: 0; padding: 0; }
    .container { max-width: 400px; margin: 40px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 24px; }
    h1 { text-align: center; color: #2a6fa1; }
    #star-balance { font-size: 1.1em; font-weight: bold; margin-bottom: 16px; text-align: right; }
    #fishing-inventory { min-height: 60px; background: #f4f8fa; border-radius: 8px; padding: 12px; margin-bottom: 16px; }
    .btn { padding: 10px 18px; border: none; border-radius: 6px; background: #2a6fa1; color: #fff; font-size: 1em; cursor: pointer; margin-right: 8px; }
    .btn:disabled { background: #aaa; cursor: not-allowed; }
    #msg { margin: 12px 0; color: #d9534f; min-height: 20px; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ£ ë‚šì‹œ ê²Œì„</h1>
    <div id="star-balance">ë³„ê°€ë£¨: -</div>
    <div id="fishing-inventory">ì¸ë²¤í† ë¦¬ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    <button id="fish-btn" class="btn">ë‚šì‹œí•˜ê¸° (-30)</button>
    <button id="sell-btn" class="btn">ëª¨ë‘ íŒë§¤</button>
    <div id="msg"></div>
  </div>
  <script type="module">
    import './firebase-config.js';
    import { StarSystem } from './star-system.js';
    import './fishing.js';

    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    function getCurrentUser() {
      return window.firebaseAuth && window.firebaseAuth.currentUser;
    }

    const msgBox = document.getElementById('msg');
    function showMsg(msg, color='#2a6fa1') {
      msgBox.textContent = msg;
      msgBox.style.color = color;
    }

    let starSystem, fishingGame;
    async function updateStarBalance() {
      if (!starSystem) return;
      try {
        const stars = await starSystem.getCurrentUserStars();
        document.getElementById('star-balance').textContent = `ë³„ê°€ë£¨: ${stars}`;
      } catch {
        document.getElementById('star-balance').textContent = 'ë³„ê°€ë£¨: -';
      }
    }

    async function init() {
      if (!getCurrentUser()) {
        showMsg('ë¡œê·¸ì¸ í›„ ì´ìš©í•´ ì£¼ì„¸ìš”.', '#d9534f');
        document.getElementById('fish-btn').disabled = true;
        document.getElementById('sell-btn').disabled = true;
        return;
      }
      starSystem = new StarSystem({ auth: window.firebaseAuth, db: window.firebaseDB });
      starSystem.setUser(getCurrentUser());
      fishingGame = new window.FishingGame(starSystem);
      await fishingGame.loadInventory();
      await updateStarBalance();
      showMsg('ë‚šì‹œë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!');
      document.getElementById('fish-btn').onclick = async () => {
        await fishingGame.fish();
        await updateStarBalance();
      };
      document.getElementById('sell-btn').onclick = async () => {
        await fishingGame.sellAll();
        await updateStarBalance();
      };
    }

    // Firebase ì¸ì¦ ìƒíƒœ ë³€í™” ê°ì§€
    import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js').then(mod => {
      const onAuthStateChanged = mod.onAuthStateChanged || (mod.default && mod.default.onAuthStateChanged);
      if (typeof onAuthStateChanged !== 'function') return;
      onAuthStateChanged(window.firebaseAuth, () => {
        init();
      });
    });
  </script>
</body>
</html> 